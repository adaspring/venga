<!-- Enhanced index.html with text input option - FIXED REFINEMENT ISSUE -->
{% extends "base.html" %}

{% block content %}

<div class="upload-container">
  <h1>GoTranslance</h1>
  
  <!-- Error container (for API errors) -->
  <div id="error-alert" class="alert alert-danger" style="display: none;"></div>
  
  <!-- Processing Mode Selection -->
  <div class="form-group">
    <label class="mode-selection-label">What do you prefer to do?</label>
    <div class="mode-selection">
      <div class="radio-option">
        <input type="radio" id="mode_html" name="processing_mode" value="html" checked>
        <label for="mode_html">
          <i class="fas fa-file-code"></i>
          <strong>Upload files</strong>
          <small>Process content for HTML, SQL, Python, Django, Flask, and Jinja2 frameworks</small>
        </label>
      </div>
      <div class="radio-option">
        <input type="radio" id="mode_text" name="processing_mode" value="text">
        <label for="mode_text">
          <i class="fas fa-edit"></i>
          <strong>Paste content</strong>
          <small>Write or paste your code or text directly</small>
        </label>
      </div>
    </div>
  </div>
  
  <!-- HTML Files Form -->
  <form id="uploadForm" method="POST" enctype="multipart/form-data" class="processing-form" novalidate>
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    
    <!-- File Selection Area -->
    <div class="form-group" id="file-selection-group">
      <label for="html_files">Select files to translate</label>
      
      <!-- File Accumulator Display -->
      <div id="fileList" class="file-list" style="display: none;">
        <div class="file-list-header">
          <strong>Files:</strong>
        </div>
        <div id="fileItems" class="file-items">
          <!-- Files will be added here dynamically -->
        </div>
      </div>
      
      <!-- Hidden input for form submission -->
      <input type="file" id="html_files" name="html_files" 
             multiple accept=".html" required
             class="form-control-file" style="display: none;">
      
      <!-- File Input Button -->
      <div class="file-input-wrapper">
        <input type="file" id="fileSelector" multiple accept=".html" 
               style="display: none;" data-role="selector">
        <button type="button" id="addFilesBtn" class="btn btn-secondary">
          <i class="fas fa-plus"></i>Upload files
        </button>
        <small class="form-text text-muted"></small>
      </div>
    </div>
    
    <!-- Language Selection for HTML Form -->
    <div class="language-selection">
      <!-- Primary Language selection -->
      <div class="form-group">
        <label for="html_primary_lang">Source language</label>
        <select id="html_primary_lang" name="primary_lang" class="form-control" required>
          <option value="">Select language...</option>
          {% for code, name in primary_langs.items() %}
          <option value="{{ code }}">{{ name }}</option>
          {% endfor %}
        </select>
      </div>
      
      <!-- Target Language selection -->
      <div class="form-group">
        <label for="html_target_lang">Target language</label>
        <select id="html_target_lang" name="target_lang" class="form-control" required>
          <option value="">Select language...</option>
          {% for code, name in target_langs.items() %}
          <option value="{{ code }}">{{ name }}</option>
          {% endfor %}
        </select>
      </div>
      
      <!-- Secondary Language selection (optional) -->
      <div class="form-group">
        <label for="html_secondary_lang">Secondary language (for multilingual content)
        <span class="info-icon-wrapper">
      <span class="info-icon" data-tooltip="secondary-info-html">i</span>
      <div class="tooltip" id="secondary-info-html">
        For content with more than one language choose which two languages you want to translate simultaneously.
      </div>
        </span>
        </label>
        <select id="html_secondary_lang" name="secondary_lang" class="form-control">
          <option value="">None</option>
          {% for code, name in secondary_langs.items() %}
          <option value="{{ code }}">{{ name }}</option>
          {% endfor %}
        </select>
        <small class="form-text text-muted"></small>
      </div>

      <!-- GPT Refinement Toggle for HTML -->
      <div class="form-group">
        <label for="html_refinement_mode"><strong>GPT Refinement Mode</strong></label>
        <select id="html_refinement_mode" name="refinement_mode" class="form-control">
          <option value="none">No GPT refinement (DeepL only)</option>
          <option value="refinement">GPT refinement only</option>
          <option value="full" selected>GPT refinement and harmonization</option>
        </select>
        <small class="form-text text-muted">Improves translation quality using OpenAI GPT. It's free, go ahead and enjoy.</small>
      </div>
    </div>
    
    <button type="submit" class="btn btn-primary" id="processBtn">
      Process content
    </button>
    
    <!-- Progress indicator -->
    <div id="upload-progress" class="progress-bar-container" style="display: none; margin-top: 15px;">
      <div class="progress">
        <div class="progress-bar" role="progressbar" style="width: 0%; background-color: #007bff; height: 20px; transition: width 0.3s ease;"></div>
      </div>
      <small class="status-text">Preparing upload...</small>
    </div>
  </form>
  
  <!-- Text Input Form -->
  <form id="textForm" method="POST" class="processing-form" style="display: none;">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    
    <!-- Text Input Area -->
    <div class="form-group" id="text-input-group">
      <label for="text_input">Text to translate</label>
      <textarea id="text_input" name="text_input" 
                class="form-control" rows="10" 
                placeholder="Enter your text here (max 1000 words)..."
                maxlength="10000"></textarea>
      <small class="form-text text-muted">
        <span id="word-count">0</span> words, <span id="char-count">0</span> characters
        <span id="word-limit-warning" class="text-danger" style="display: none;">
          (Exceeds 1000 word limit)
        </span>
      </small>
    </div>
    
    <!-- Language Selection for Text Form -->
    <div class="language-selection">
      <!-- Primary Language selection -->
      <div class="form-group">
        <label for="text_primary_lang">Source language</label>
        <select id="text_primary_lang" name="primary_lang" class="form-control" required>
          <option value="">Select language...</option>
          {% for code, name in primary_langs.items() %}
          <option value="{{ code }}">{{ name }}</option>
          {% endfor %}
        </select>
      </div>
      
      <!-- Target Language selection -->
      <div class="form-group">
        <label for="text_target_lang">Target language</label>
        <select id="text_target_lang" name="target_lang" class="form-control" required>
          <option value="">Select language...</option>
          {% for code, name in target_langs.items() %}
          <option value="{{ code }}">{{ name }}</option>
          {% endfor %}
        </select>
      </div>
      
      <!-- Secondary Language selection (optional) -->
      <div class="form-group">
        <label for="text_secondary_lang">Secondary language (for multilingual content)
        <span class="info-icon-wrapper">
      <span class="info-icon" data-tooltip="secondary-info-text">i</span>
      <div class="tooltip" id="secondary-info-text">
        For content with more than one language choose which two languages you want to translate simultaneously.
      </div>
        </span>
        </label>
        <select id="text_secondary_lang" name="secondary_lang" class="form-control">
          <option value="">None</option>
          {% for code, name in secondary_langs.items() %}
          <option value="{{ code }}">{{ name }}</option>
          {% endfor %}
        </select>
        <small class="form-text text-muted"></small>
      </div>

      <!-- GPT Refinement Toggle for Text -->
      <div class="form-group">
        <label for="text_refinement_mode"><strong>GPT Refinement Mode</strong></label>
        <select id="text_refinement_mode" name="refinement_mode" class="form-control">
          <option value="none">No GPT refinement (DeepL only)</option>
          <option value="refinement">GPT refinement only</option>
          <option value="full" selected>GPT refinement and harmonization</option>
        </select>
        <small class="form-text text-muted">Improves translation quality using OpenAI GPT. It's free, go ahead and enjoy.</small>
      </div>
    </div>
    
    <button type="submit" class="btn btn-primary" id="processTextBtn">
      Process content
    </button>
    
    <!-- Progress indicator for text -->
    <div id="text-progress" class="progress-bar-container" style="display: none; margin-top: 15px;">
      <div class="progress">
        <div class="progress-bar" role="progressbar" style="width: 0%; background-color: #28a745; height: 20px; transition: width 0.3s ease;"></div>
      </div>
      <small class="status-text">Processing text...</small>
    </div>
  </form>
</div>

<style>
/* Mode Selection Styles */
.mode-selection-label {
  font-weight: bold;
  margin-bottom: 10px;
  display: block;
}

.mode-selection {
  display: flex;
  gap: 20px;
  margin-bottom: 30px;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 20px;
  background-color: #f9f9f9;
}

.radio-option {
  flex: 1;
  position: relative;
}

.radio-option input[type="radio"] {
  position: absolute;
  opacity: 0;
  cursor: pointer;
}

.radio-option label {
  display: block;
  padding: 20px;
  border: 2px solid #ddd;
  border-radius: 6px;
  background-color: white;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
}

.radio-option label:hover {
  border-color: #007bff;
  background-color: #f8f9fa;
}

.radio-option input[type="radio"]:checked + label {
  border-color: #007bff;
  background-color: #e3f2fd;
  color: #007bff;
}

.radio-option label i {
  font-size: 24px;
  margin-bottom: 8px;
  display: block;
}

.radio-option label strong {
  display: block;
  margin-bottom: 5px;
}

.radio-option label small {
  color: #666;
  font-size: 12px;
}

/* Form Styles */
.processing-form {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
  background-color: white;
}

.language-selection {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 20px;
  background-color: #f9f9f9;
  margin-top: 20px;
}

/* Text Input Styles */
#text_input {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 14px;
  line-height: 1.5;
  resize: vertical;
  min-height: 200px;
}

#text_input:focus {
  border-color: #007bff;
  box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

/* File Accumulator Styles */
.file-list {
  border: 1px solid #ddd;
  border-radius: 4px;
  padding: 15px;
  margin-bottom: 15px;
  background-color: #f9f9f9;
}

.file-list-header {
  margin-bottom: 10px;
  color: #333;
}

.file-items {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.file-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background-color: white;
  border: 1px solid #e0e0e0;
  border-radius: 3px;
  font-size: 14px;
}

.file-name {
  flex-grow: 1;
  color: #333;
}

.file-size {
  color: #666;
  font-size: 12px;
  margin-right: 10px;
}

.remove-file {
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 3px;
  padding: 4px 8px;
  cursor: pointer;
  font-size: 12px;
}

.remove-file:hover {
  background: #c82333;
}

.file-input-wrapper {
  margin-top: 10px;
}

.btn-secondary {
  background-color: #6c757d;
  color: white;
  border: 1px solid #6c757d;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.btn-secondary:hover {
  background-color: #5a6268;
  border-color: #545b62;
}

/* Progress Bar Styles */
.progress-bar-container {
  margin-top: 15px;
}

.progress {
  width: 100%;
  height: 20px;
  background-color: #f8f9fa;
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 5px;
}

.progress-bar {
  height: 100%;
  background-color: #007bff;
  transition: width 0.3s ease;
}

.status-text {
  color: #666;
  font-size: 12px;
}

.info-icon-wrapper {
  position: relative;
  display: inline-block;
  margin-left: 5px;
}

.info-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  background-color: #007bff;
  color: white;
  border-radius: 50%;
  font-size: 10px;
  font-weight: bold;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.info-icon:hover {
  background-color: #0056b3;
}

.tooltip {
  position: absolute;
  bottom: 25px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #333;
  color: white;
  padding: 6px 16px;
  border-radius: 6px;
  font-size: 12px;
  white-space: nowrap;
  max-width: 300px;
  min-width: 250px;
  white-space: normal;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  line-height: 1.3;
}

.tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 5px solid transparent;
  border-top-color: #333;
}

.tooltip.show {
  opacity: 1;
  visibility: visible;
}

/* Responsive Design */
@media (max-width: 768px) {
  .mode-selection {
    flex-direction: column;
    gap: 10px;
  }
  
  .radio-option label {
    padding: 15px;
  }
  
  .radio-option label i {
    font-size: 20px;
  }
}
</style>

<script>

// Disable automatic form handling from progress.js on this page
window.DISABLE_AUTO_UPLOAD = true;

// Text Input Manager
class TextInputManager {
  constructor() {
    this.textInput = document.getElementById('text_input');
    this.wordCount = document.getElementById('word-count');
    this.charCount = document.getElementById('char-count');
    this.wordLimitWarning = document.getElementById('word-limit-warning');
    this.processTextBtn = document.getElementById('processTextBtn');
    
    this.init();
  }
  
  init() {
    this.textInput.addEventListener('input', () => {
      this.updateCounts();
    });
    
    this.textInput.addEventListener('paste', () => {
      // Slight delay to allow paste content to be processed
      setTimeout(() => this.updateCounts(), 100);
    });
    
    this.updateCounts();
  }
  
  updateCounts() {
    const text = this.textInput.value.trim();
    const words = text ? text.split(/\s+/).length : 0;
    const chars = text.length;
    
    this.wordCount.textContent = words;
    this.charCount.textContent = chars;
    
    // Check word limit
    if (words > 1000) {
      this.wordLimitWarning.style.display = 'inline';
      this.processTextBtn.disabled = true;
      this.textInput.style.borderColor = '#dc3545';
    } else {
      this.wordLimitWarning.style.display = 'none';
      this.processTextBtn.disabled = false;
      this.textInput.style.borderColor = '';
    }
  }
  
  getText() {
    return this.textInput.value.trim();
  }
  
  getWordCount() {
    const text = this.getText();
    return text ? text.split(/\s+/).length : 0;
  }
}

// File Accumulator Manager (from original code)
class FileAccumulator {
  constructor() {
    this.files = new Map();
    this.fileSelector = document.getElementById('fileSelector');
    this.addFilesBtn = document.getElementById('addFilesBtn');
    this.fileList = document.getElementById('fileList');
    this.fileItems = document.getElementById('fileItems');
    this.hiddenInput = document.getElementById('html_files');
    this.processBtn = document.getElementById('processBtn');
    
    this.init();
  }
  
  init() {
    this.hiddenInput.removeAttribute('required');
    
    this.addFilesBtn.addEventListener('click', () => {
      this.fileSelector.click();
    });
    
    this.fileSelector.addEventListener('change', (e) => {
      this.addFiles(e.target.files);
      e.target.value = '';
    });
    
    this.updateProcessButton();
  }
  
  addFiles(fileList) {
    let addedCount = 0;
    
    for (let file of fileList) {
      if (!this.files.has(file.name)) {
        this.files.set(file.name, file);
        addedCount++;
      }
    }
    
    if (addedCount > 0) {
      this.updateDisplay();
      this.updateHiddenInput();
      this.updateProcessButton();
    }
  }
  
  removeFile(fileName) {
    this.files.delete(fileName);
    this.updateDisplay();
    this.updateHiddenInput();
    this.updateProcessButton();
  }
  
  updateDisplay() {
    if (this.files.size === 0) {
      this.fileList.style.display = 'none';
      return;
    }
    
    this.fileList.style.display = 'block';
    this.fileItems.innerHTML = '';
    
    for (let [fileName, file] of this.files) {
      const fileItem = document.createElement('div');
      fileItem.className = 'file-item';
      
      const fileSize = this.formatFileSize(file.size);
      
      fileItem.innerHTML = `
        <span class="file-name">${fileName}</span>
        <span class="file-size">${fileSize}</span>
        <button type="button" class="remove-file" data-filename="${fileName}">
          ✕
        </button>
      `;
      
      const removeBtn = fileItem.querySelector('.remove-file');
      removeBtn.addEventListener('click', () => this.removeFile(fileName));
      
      this.fileItems.appendChild(fileItem);
    }
  }
  
  updateHiddenInput() {
    const dt = new DataTransfer();
    
    for (let [fileName, file] of this.files) {
      dt.items.add(file);
    }
    
    this.hiddenInput.files = dt.files;
  }
  
  updateProcessButton() {
    this.processBtn.disabled = this.files.size === 0;
  }
  
  formatFileSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
  }
}

// Mode Manager
class ModeManager {
  constructor() {
    this.htmlMode = document.getElementById('mode_html');
    this.textMode = document.getElementById('mode_text');
    this.htmlForm = document.getElementById('uploadForm');
    this.textForm = document.getElementById('textForm');
    this.fileSelectionGroup = document.getElementById('file-selection-group');
    this.textInputGroup = document.getElementById('text-input-group');
    
    this.init();
  }
  
  init() {
    this.htmlMode.addEventListener('change', () => {
      if (this.htmlMode.checked) {
        this.switchToHtmlMode();
      }
    });
    
    this.textMode.addEventListener('change', () => {
      if (this.textMode.checked) {
        this.switchToTextMode();
      }
    });
    
    // Initialize in HTML mode
    this.switchToHtmlMode();
  }
  
  switchToHtmlMode() {
    this.htmlForm.style.display = 'block';
    this.textForm.style.display = 'none';
    
    // Update form action and validation
    this.htmlForm.action = '/api/upload';
    this.htmlForm.querySelector('#html_files').setAttribute('required', 'required');
    
    // Sync language selections from text to HTML form
    this.syncLanguageSelections('text', 'html');
  }
  
  switchToTextMode() {
    this.htmlForm.style.display = 'none';
    this.textForm.style.display = 'block';
    
    // Update form action and validation
    this.textForm.action = '/api/upload';  // Use same endpoint
    this.textForm.querySelector('#text_input').setAttribute('required', 'required');
    this.htmlForm.querySelector('#html_files').removeAttribute('required');
    
    // Sync language selections from HTML to text form
    this.syncLanguageSelections('html', 'text');
  }
  
  // Sync language selections between forms
  syncLanguageSelections(fromPrefix, toPrefix) {
    const mappings = [
      ['primary_lang', 'primary_lang'],
      ['target_lang', 'target_lang'],
      ['secondary_lang', 'secondary_lang'],
      ['refinement_mode', 'refinement_mode']  // Changed from enable_refinement
    ];
    
    mappings.forEach(([field, _]) => {
      const fromElement = document.getElementById(`${fromPrefix}_${field}`);
      const toElement = document.getElementById(`${toPrefix}_${field}`);
      
      if (fromElement && toElement) {
        toElement.value = fromElement.value;
      }
    });
  }
}

// Form Handlers
class FormHandler {
  constructor() {
    this.htmlForm = document.getElementById('uploadForm');
    this.textForm = document.getElementById('textForm');
    this.init();
  }
  
  init() {
    this.htmlForm.addEventListener('submit', (e) => {
      e.preventDefault();
      this.handleHtmlSubmit();
    });
    
    this.textForm.addEventListener('submit', (e) => {
      e.preventDefault();
      this.handleTextSubmit();
    });
  }
  
  handleHtmlSubmit() {
    const primaryLang = document.getElementById('html_primary_lang');
    const targetLang = document.getElementById('html_target_lang');
    const secondaryLang = document.getElementById('html_secondary_lang');
    const refinementMode = document.getElementById('html_refinement_mode');  // Changed
    
    // Validate
    if (window.fileAccumulator.files.size === 0) {
      this.showError('Please select at least one HTML file');
      return;
    }
    
    if (!primaryLang.value) {
      this.showError('Please select a primary language');
      return;
    }
    
    if (!targetLang.value) {
      this.showError('Please select a target language');
      return;
    }
    
    // Show progress
    const progressContainer = document.getElementById('upload-progress');
    const progressBar = progressContainer.querySelector('.progress-bar');
    const statusText = progressContainer.querySelector('.status-text');
    
    progressContainer.style.display = 'block';
    progressBar.style.width = '25%';
    statusText.textContent = 'Uploading files...';
    
    // Prepare form data
    const formData = new FormData();
    
    // Add files from accumulator
    for (let [fileName, file] of window.fileAccumulator.files) {
      formData.append('html_files', file);
    }
    
    formData.append('input_type', 'file');
    formData.append('primary_lang', primaryLang.value);
    formData.append('target_lang', targetLang.value);
    formData.append('secondary_lang', secondaryLang.value);
    formData.append('refinement_mode', refinementMode.value);  // Changed
    formData.append('csrf_token', document.querySelector('input[name="csrf_token"]').value);
    
    // Debug logging
    console.log('HTML Form Submit Debug:');
    console.log('Refinement Mode:', refinementMode.value);  // Changed
    console.log('FormData refinement_mode:', formData.get('refinement_mode'));
    
    // Submit via fetch
    fetch('/api/upload', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        progressBar.style.width = '50%';
        statusText.textContent = 'Processing started...';
        
        // Redirect to processing page
        setTimeout(() => {
          window.location.href = data.redirect;
        }, 1000);
      } else {
        throw new Error(data.message || 'Processing failed');
      }
    })
    .catch(error => {
      progressContainer.style.display = 'none';
      this.showError(error.message);
    });
  }


  handleTextSubmit() {
  const textInput = document.getElementById('text_input');
  const primaryLang = document.getElementById('text_primary_lang');
  const targetLang = document.getElementById('text_target_lang');
  const secondaryLang = document.getElementById('text_secondary_lang');
  const refinementMode = document.getElementById('text_refinement_mode');
  
  // Validate form
  if (!textInput.value.trim()) {
    this.showError('Please enter text to translate');
    return;
  }
  
  if (!primaryLang.value) {
    this.showError('Please select a primary language');
    return;
  }
  
  if (!targetLang.value) {
    this.showError('Please select a target language');
    return;
  }
  
  if (window.textInputManager.getWordCount() > 1000) {
    this.showError('Text exceeds 1000 word limit');
    return;
  }
  
  // Show progress
  const progressContainer = document.getElementById('text-progress');
  const progressBar = progressContainer.querySelector('.progress-bar');
  const statusText = progressContainer.querySelector('.status-text');
  
  progressContainer.style.display = 'block';
  progressBar.style.width = '25%';
  statusText.textContent = 'Sending text for processing...';
  
  // Prepare form data
  const formData = new FormData();
  formData.append('text_content', textInput.value.trim());
  formData.append('input_type', 'text');
  formData.append('primary_lang', primaryLang.value);
  formData.append('target_lang', targetLang.value);
  formData.append('secondary_lang', secondaryLang.value);
  formData.append('refinement_mode', refinementMode.value);  // Changed from enable_refinement
  formData.append('csrf_token', document.querySelector('input[name="csrf_token"]').value);
  
  // Debug logging
  console.log('Text Form Submit Debug:');
  console.log('Refinement Mode:', refinementMode.value);
  console.log('FormData refinement_mode:', formData.get('refinement_mode'));
  
  // Submit via fetch
  fetch('/api/upload', {
    method: 'POST',
    body: formData
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      progressBar.style.width = '50%';
      statusText.textContent = 'Processing started...';
      
      // Redirect to processing page
      setTimeout(() => {
        window.location.href = data.redirect;
      }, 1000);
    } else {
      throw new Error(data.message || 'Processing failed');
    }
  })
  .catch(error => {
    progressContainer.style.display = 'none';
    this.showError(error.message);
  });
  }

  
  showError(message) {
    const errorAlert = document.getElementById('error-alert');
    errorAlert.textContent = message;
    errorAlert.style.display = 'block';
    
    // Hide after 5 seconds
    setTimeout(() => {
      errorAlert.style.display = 'none';
    }, 5000);
  }
}



document.addEventListener('DOMContentLoaded', () => {
  const infoIcons = document.querySelectorAll('.info-icon');
  
  infoIcons.forEach(icon => {
    const tooltipId = icon.getAttribute('data-tooltip');
    const tooltip = document.getElementById(tooltipId);
    
    if (tooltip) {
      icon.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        // Hide all other tooltips
        document.querySelectorAll('.tooltip').forEach(t => t.classList.remove('show'));
        
        // Show this tooltip
        tooltip.classList.add('show');
      });
    }
  });
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.info-icon-wrapper')) {
      document.querySelectorAll('.tooltip').forEach(tooltip => {
        tooltip.classList.remove('show');
      });
    }
  });
});


// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  window.fileAccumulator = new FileAccumulator();
  window.textInputManager = new TextInputManager();
  window.modeManager = new ModeManager();
  window.formHandler = new FormHandler();
});
</script>

<!-- The existing progress.js is loaded in base.html for HTML uploads -->
{% endblock %}